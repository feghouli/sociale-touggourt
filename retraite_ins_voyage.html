<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø§Ø¹Ø¯ÙŠÙ† ÙˆØ§Ù„Ø£Ø±Ø§Ù…Ù„ ÙÙŠ Ø§Ù„Ø±Ø­Ù„Ø§Øª 2025</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBnbQtyrGMltRuC9jhgu4OA9vaTXX5PXW8",
      authDomain: "omratouggourt.firebaseapp.com",
      projectId: "omratouggourt",
      storageBucket: "omratouggourt.firebasestorage.app",
      messagingSenderId: "414370554511",
      appId: "1:414370554511:web:c16fead011fa1e39e286fa",
      measurementId: "G-R5SER55HX5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const scriptURL = "https://script.google.com/macros/s/AKfycbxx2VsNZOkDnmAI_mh4ZJ8MMYkgbvWcCVF8qx4_9Ysf0c998TDRw15fw57LOi9ztlPwkA/exec";

    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨
    window.validateNumber = input => {
      input.value = input.value.replace(/\D/g, '');
      if (input.value.length > 10) input.value = input.value.slice(0, 10);
    };

    window.checkAccount = async function() {
      const account = document.getElementById("account").value.trim();
      if (account.length < 7 || account.length > 10) {
        Swal.fire({ icon: 'warning', title: 'ØªÙ†Ø¨ÙŠÙ‡', text: 'Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠÙ† 7 Ùˆ10 Ø£Ø±Ù‚Ø§Ù…' });
        return;
      }

      Swal.fire({ title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

      const normalized = account.replace(/^0+/, "");

      try {
        const q = query(collection(db, "retraite"), where("account", "==", normalized));
        const snapshot = await getDocs(q);

        Swal.close();

        if (snapshot.empty) {
          Swal.fire({
            icon: "error",
            title: "âŒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯",
            text: "Ø±Ù‚Ù… Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯",
            confirmButtonText: "ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"
          }).then(() => location.reload());
          return;
        }

        const data = snapshot.docs[0].data();
        Swal.fire({
          icon: "success",
          title: "âœ… Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
          html: `<b>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:</b> ${data.account}<br><b>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</b> ${data.name}`,
          confirmButtonText: "Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„"
        }).then(() => showForm(account, data.name));

      } catch (err) {
        console.error(err);
        Swal.fire("âŒ Ø®Ø·Ø£", "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "error");
      }
    };

    // ğŸ§¾ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
    window.showForm = function(account, name) {
      const container = document.getElementById("mainContainer");
      container.innerHTML = `
        <h2>Ø§Ø³ØªÙ…Ø§Ø±Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø§Ø¹Ø¯ÙŠÙ† ÙˆØ§Ù„Ø£Ø±Ø§Ù…Ù„</h2>

        <input type="text" id="accountField" value="${account}" readonly>
        <input type="text" id="nameField" value="${name}" readonly>

        <select id="statusField">
          <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙØ©</option>
          <option value="Ù…ØªÙ‚Ø§Ø¹Ø¯(Ø©)">Ù…ØªÙ‚Ø§Ø¹Ø¯(Ø©)</option>
          <option value="Ø£Ø±Ù…Ù„Ø©">Ø£Ø±Ù…Ù„Ø©</option>
        </select>

        <select id="daairaField" onchange="updateBaladiya()">
          <option value="">Ø§Ø®ØªØ± Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©</option>
          <option value="ØªÙˆÙ‚Ø±Øª">ØªÙˆÙ‚Ø±Øª</option>
          <option value="ØªÙ…Ø§Ø³ÙŠÙ†">ØªÙ…Ø§Ø³ÙŠÙ†</option>
          <option value="Ø§Ù„Ù…Ù‚Ø§Ø±ÙŠÙ†">Ø§Ù„Ù…Ù‚Ø§Ø±ÙŠÙ†</option>
          <option value="Ø§Ù„Ø­Ø¬ÙŠØ±Ø©">Ø§Ù„Ø­Ø¬ÙŠØ±Ø©</option>
          <option value="Ø§Ù„Ø·ÙŠØ¨Ø§Øª">Ø§Ù„Ø·ÙŠØ¨Ø§Øª</option>
        </select>

        <select id="baladiyaField">
          <option value="">Ø§Ø®ØªØ± Ø¨Ù„Ø¯ÙŠØ© Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©</option>
        </select>

        <select id="tripField">
          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø±Ø­Ù„Ø©</option>
          <option value="Ù…ØµØ±">Ù…ØµØ±</option>
          <option value="Ù‚Ø§Ù„Ù…Ø©">Ù‚Ø§Ù„Ù…Ø©</option>
          <option value="Ø³Ø·ÙŠÙ">Ø³Ø·ÙŠÙ</option>
          <option value="ØªÙ…Ù†Ø±Ø§Ø³Øª">ØªÙ…Ù†Ø±Ø§Ø³Øª</option>
        </select>

        <input type="text" id="phoneField" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (10 Ø£Ø±Ù‚Ø§Ù…)" oninput="validatePhone(this)">
        <button id="submitBtn" onclick="submitForm()">ØªØ³Ø¬ÙŠÙ„</button>
      `;

      window.baladiyaMap = {
        "ØªÙˆÙ‚Ø±Øª": ["ØªÙˆÙ‚Ø±Øª", "Ø§Ù„Ù†Ø²Ù„Ø©", "ØªØ¨Ø³Ø¨Ø³Øª", "Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ø¨Ø¯ÙŠØ©"],
        "ØªÙ…Ø§Ø³ÙŠÙ†": ["ØªÙ…Ø§Ø³ÙŠÙ†", "Ø¨Ù„Ø¯Ø© Ø¹Ù…Ø±"],
        "Ø§Ù„Ù…Ù‚Ø§Ø±ÙŠÙ†": ["Ø§Ù„Ù…Ù‚Ø§Ø±ÙŠÙ†", "Ø³ÙŠØ¯ÙŠ Ø³Ù„ÙŠÙ…Ø§Ù†"],
        "Ø§Ù„Ø­Ø¬ÙŠØ±Ø©": ["Ø§Ù„Ø­Ø¬ÙŠØ±Ø©", "Ø§Ù„Ø¹Ø§Ù„ÙŠØ©"],
        "Ø§Ù„Ø·ÙŠØ¨Ø§Øª": ["Ø§Ù„Ø·ÙŠØ¨Ø§Øª", "Ø§Ù„Ù…Ù†Ù‚Ø±", "Ø§Ø¨Ù† Ù†Ø§ØµØ±"]
      };
    };

    window.updateBaladiya = function() {
      const daaira = document.getElementById("daairaField").value;
      const baladiyaSelect = document.getElementById("baladiyaField");
      baladiyaSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø¨Ù„Ø¯ÙŠØ© Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©</option>';
      if (daaira && window.baladiyaMap[daaira]) {
        window.baladiyaMap[daaira].forEach(b => {
          const option = document.createElement("option");
          option.value = b; option.text = b;
          baladiyaSelect.add(option);
        });
      }
    };

    window.validatePhone = function(input) {
      let value = input.value.replace(/\D/g, "");
      if (value.length > 10) value = value.slice(0, 10);
      let formatted = "";
      for (let i = 0; i < value.length; i += 2) {
        if (i > 0) formatted += " ";
        formatted += value.substring(i, i + 2);
      }
      input.value = formatted;
    };

    // ğŸš€ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheets
    window.submitForm = async function() {
      const account = document.getElementById("accountField").value;
      const name = document.getElementById("nameField").value;
      const status = document.getElementById("statusField").value.trim();
      const daaira = document.getElementById("daairaField").value.trim();
      const baladiya = document.getElementById("baladiyaField").value.trim();
      const trip = document.getElementById("tripField").value.trim();
      const phone = document.getElementById("phoneField").value.trim();

      if (!status || !daaira || !baladiya || !trip || phone.replace(/\s/g, '').length !== 10) {
        Swal.fire("âš ï¸ ØªÙ†Ø¨ÙŠÙ‡", "ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­", "warning");
        return;
      }

      Swal.fire({ title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

      const params = new URLSearchParams();
      params.append("action", "register");
      params.append("account", account);
      params.append("name", name);
      params.append("status", status);
      params.append("daaira", daaira);
      params.append("baladiya", baladiya);
      params.append("trip", trip);
      params.append("phone", phone);

      try {
        const res = await fetch(scriptURL, { method: "POST", body: params });
        const data = await res.json();

        Swal.close();

        // âœ… Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ â€” ÙØªØ­ ÙÙŠ Ù†ÙØ³ Ø§Ù„ØµÙØ­Ø©
        if (data.result === "success") {
          Swal.fire({
            title: "âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­",
            icon: "success",
            showCancelButton: true,
            confirmButtonText: "ğŸ“„ ØªØ­Ù…ÙŠÙ„ ÙˆØµÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
            cancelButtonText: "ğŸ”™ Ø¥ØºÙ„Ø§Ù‚"
          }).then(result => {
            if (result.isConfirmed) {
              window.location.href = `https://feghouli.github.io/dawnload_recip_retraite/?empId=${account}`;
            } else {
              location.reload();
            }
          });
        } 
        // âš ï¸ Ø­Ø§Ù„Ø© Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ù‹Ø§ â€” ÙØªØ­ ÙÙŠ Ù†ÙØ³ Ø§Ù„ØµÙØ­Ø© Ø£ÙŠØ¶Ù‹Ø§
        else if (data.result === "exists") {
          const d = data.data;
          Swal.fire({
            title: "âš ï¸ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ù‹Ø§",
            html: `<b>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:</b> ${d.account}<br>
                   <b>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</b> ${d.name}<br>
                   <b>Ø§Ù„ØµÙØ©:</b> ${d.status}<br>
                   <b>Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©:</b> ${d.daaira}<br>
                   <b>Ø¨Ù„Ø¯ÙŠØ© Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©:</b> ${d.baladiya}<br>
                   <b>Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</b> ${d.trip}<br>
                   <b>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</b> ${d.phone}`,
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "ğŸ“„ ØªØ­Ù…ÙŠÙ„ ÙˆØµÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
            cancelButtonText: "ğŸ”™ Ø¥ØºÙ„Ø§Ù‚"
          }).then(result => {
            if (result.isConfirmed) {
              window.location.href = `https://feghouli.github.io/dawnload_recip_retraite/?empId=${d.account}`;
            } else {
              location.reload();
            }
          });
        } 
        else {
          Swal.fire("âŒ Ø®Ø·Ø£", "ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "error");
        }
      } catch (err) {
        console.error(err);
        Swal.fire("âŒ Ø®Ø·Ø£", "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…", "error");
      }
    };
  </script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh; padding: 15px;
    }
    .container {
      background: white; padding: 35px 25px; border-radius: 18px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.2); text-align: center;
      width: 100%; max-width: 500px;
      font-family: 'Cairo', sans-serif;
    }
    input, select, button, h2 {
      font-family: 'Cairo', sans-serif;
    }
    input, select {
      width: 100%; padding: 14px 18px; margin-bottom: 18px;
      border-radius: 10px; border: 2px solid #e0e0e0;
      font-size: 15px; text-align: center;
    }
    input:focus, select:focus { outline: none; border-color: #2575fc; }
    button {
      background: linear-gradient(45deg, #6a11cb, #2575fc);
      color: white; border: none; padding: 14px 0;
      border-radius: 10px; font-size: 15px; cursor: pointer;
      font-weight: 600; width: 100%;
    }
    #phoneField {
      direction: ltr;
      text-align: center;
    }

    .page-header {
      text-align: center;
      margin-bottom: 25px;
      font-family: "Cairo", sans-serif;
    }

    .page-header .header-logo {
      width: 160px;
      height: auto;
      display: block;
      margin: 0 auto 15px auto;
      filter: contrast(1.05) brightness(1.1);
      animation: pulseLogo 2.5s ease-in-out infinite;
    }

    @keyframes pulseLogo {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.08); }
    }

    .gradient-title {
      font-family: "Cairo", sans-serif;
      font-size: 24px;
      font-weight: 600;
      background: linear-gradient(to right, #6a11cb, #2575fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: center;
      position: relative;
      margin-top: 20px;
      margin-bottom: 15px;
      display: inline-block;
    }

    .gradient-title::after {
      content: "";
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(to right, #6a11cb, #2575fc);
      border-radius: 2px;
    }
  </style>
</head>

<body>
  <div class="container" id="mainContainer">
    <div class="page-header">
      <img src="https://lh3.googleusercontent.com/d/1AOSzlvuRb-fAO0bqvo412HcHTfpRAX15" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù„Ø¬Ù†Ø©" class="header-logo">
      <div class="header-text">
        Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø´Ø¹Ø¨ÙŠØ©<br>
        ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©<br>
        Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ù„Ø¹Ù…Ø§Ù„ Ø§Ù„ØªØ±Ø¨ÙŠØ©<br>
        Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„ÙˆÙ„Ø§Ø¦ÙŠØ© Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ù„Ø¹Ù…Ø§Ù„ Ø§Ù„ØªØ±Ø¨ÙŠØ© Ù„ÙˆÙ„Ø§ÙŠØ© ØªÙˆÙ‚Ø±Øª
      </div>
    </div>

    <h2 class="gradient-title">Ø¨ÙˆØ§Ø¨Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø§Ø¹Ø¯ÙŠÙ† Ùˆ Ø§Ù„Ø£Ø±Ø§Ù…Ù„ ÙÙŠ Ø§Ù„Ø±Ø­Ù„Ø§Øª</h2>
    <input type="text" id="account" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø§Ø±ÙŠ" oninput="validateNumber(this)">
    <button onclick="checkAccount()">ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</button>
  </div>
</body>
</html>
